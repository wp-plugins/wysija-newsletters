<?php
defined('WYSIJA') or die('Restricted access'); class WYSIJA_view extends WYSIJA_object{ var $title="DEFAULT TITLE"; var $icon="icon-edit"; var $links=array(); var $search=array(); var $cols_nks=array(); function WYSIJA_view(){ } function render($type,$data){ $this->action=$type; $this->header(); $this->$type($data); $this->footer(); } function messages(){ $wysija_msg=$this->getMsgs(); $wpnonce='<input type="hidden" value="'.wp_create_nonce("wysija_ajax").'" id="wysijax" />'; if(!$wysija_msg) return '<div class="wysija-msg ajax"></div>'.$wpnonce; $html='<div class="wysija-msg">'; foreach($wysija_msg as $level =>$messages){ $html.='<div class="'.$level.'">'; $html.='<ul>'; if(count($messages)>0){ foreach($messages as $msg){ $html.='<li>'.$msg.'</li>'; } } $html.='</ul>'; $html.='</div>'; } $html.='</div><div class="wysija-msg ajax"></div>'.$wpnonce; return $html; } function secure($params=array(),$get=false,$echo=true){ if(!is_array($params)) $action=$params; else{ $action=$params['action']; if(isset($params['controller'])) $controller=$params['controller']; } if(WYSIJA_SIDE=="front"){ $nonceaction=$controller.'-action_'.$action; }else{ if(defined('DOING_AJAX')){ $nonceaction=$controller.'-action_'.$action; }else{ $nonceaction=$_REQUEST['page'].'-action_'.$action; } } if(is_array($params) && isset($params['id']) && $params['id']) $nonceaction.='-id_'.$params['id']; if($get){ return wp_create_nonce($nonceaction); }else{ return wp_nonce_field($nonceaction,'_wpnonce',true,$echo); } } function getClassValidate($params,$returnAttr=false,$prefixclass=""){ $classValidate=""; $recognisedtypes=array("email","url"); if(isset($params['req'])){ $classValidate="required"; if(isset($params['type']) && in_array($params['type'], $recognisedtypes)) { $classValidate.=",custom[".$params['type']."]"; } }else{ if(isset($params['type']) && in_array($params['type'],$recognisedtypes )) { $classValidate.="custom[".$params['type']."]"; } } if($prefixclass) $prefixclass.=" "; if($classValidate) $classValidate="validate[".$classValidate."]"; if(!$returnAttr && $classValidate) $classValidate= ' class="'.$prefixclass.$classValidate.'" '; return $classValidate; } } 